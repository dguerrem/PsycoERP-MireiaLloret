<div class="h-full overflow-y-auto space-y-6">

  <!-- Documents Table -->
  <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm">
    <div class="@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6 pb-3">
      <div class="flex items-center justify-between">
        <div class="text-base font-medium">
          Documentos del Paciente
        </div>
        <div class="flex items-center gap-4">
          <span class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 border-transparent bg-secondary text-secondary-foreground">
            {{ documents.length }} documento(s)
          </span>
          <input
            #fileInput
            type="file"
            multiple
            accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
            (change)="onFileSelected($event)"
            class="hidden">
          <button
            (click)="fileInput.click()"
            style="background-color: #0891b2"
            class="hover:opacity-90 inline-flex items-center justify-center px-3 py-2 text-white rounded-md transition-opacity font-medium text-sm">
            <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            Subir Documentos
          </button>
        </div>
      </div>
    </div>

    <div class="px-6">
      <div class="flex-1 overflow-y-auto min-h-0">
        @if (documents.length > 0) {
          <div class="overflow-x-auto">
            <table class="w-full table-fixed">
              <colgroup>
                <col class="w-[30%]">
                <col class="w-[10%]">
                <col class="w-[50%]">
                <col class="w-[10%]">
              </colgroup>
              <thead class="sticky top-0 bg-card z-10">
                <tr class="border-b">
                  <th class="text-left p-2 text-sm font-medium">Documento</th>
                  <th class="text-left p-2 text-sm font-medium">Fecha</th>
                  <th class="text-left p-2 text-sm font-medium">Descripción</th>
                  <th class="text-left p-2 text-sm font-medium">Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (document of documents; track document.id) {
                  <tr class="border-b hover:bg-muted/50">
                    <td class="p-2">
                      <div class="flex items-center gap-3 min-w-0">
                        <svg class="h-4 w-4 flex-shrink-0" [class]="getFileIcon(document.type)" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" [innerHTML]="getFileIconSvg(document.type)">
                        </svg>
                        <span class="font-medium text-sm truncate">{{ document.name }}</span>
                      </div>
                    </td>
                    <td class="p-2 text-sm text-muted-foreground whitespace-nowrap">{{ formatDate(document.upload_date) }}</td>
                    <td class="p-2">
                      <div class="text-sm text-muted-foreground overflow-x-auto whitespace-nowrap max-w-full scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
                        {{ document.description || 'Sin descripción' }}
                      </div>
                    </td>
                    <td class="p-2">
                      <div class="flex items-center gap-2 justify-end">
                      <button
                        (click)="handleViewDocument(document)"
                        class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                      </button>
                      <button
                        (click)="handleDownloadDocument(document)"
                        class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                      </button>
                      <button
                        (click)="handleDeleteDocument(document)"
                        class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground text-destructive">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H9a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
          </div>
        } @else {
          <div class="text-center py-12">
            <svg class="h-12 w-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M14 2v6h6" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 13H8" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 17H8" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M10 9H8" />
            </svg>
            <p class="text-muted-foreground">No hay documentos disponibles.</p>
            <p class="text-sm text-muted-foreground mt-2">
              Sube documentos usando el botón "Subir Documentos".
            </p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Document Viewer Modal -->
  @if (viewingDocument()) {
    <div class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[80vh] overflow-hidden">
        <!-- Modal Header -->
        <div class="flex items-center justify-between p-6 border-b">
          <div class="flex items-center gap-3">
            <svg class="h-4 w-4" [class]="getFileIcon(viewingDocument()!.type)" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" [innerHTML]="getFileIconSvg(viewingDocument()!.type)">
            </svg>
            <span class="font-semibold">{{ viewingDocument()!.name }}</span>
          </div>
          <button
            (click)="closeDocumentView()"
            class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- Modal Content -->
        <div class="flex-1 bg-gray-50 p-4 overflow-auto max-h-96">
          <div class="text-center">
            @if (viewingDocument()!.type === 'pdf') {
              <div class="space-y-4">
                <div class="bg-white p-8 rounded-lg shadow-sm">
                  <svg class="h-16 w-16 mx-auto mb-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14 2v6h6" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 13H8" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 17H8" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 9H8" />
                  </svg>
                  <h3 class="text-lg font-semibold mb-2">{{ viewingDocument()!.name }}</h3>
                  <p class="text-muted-foreground mb-4">{{ viewingDocument()!.description }}</p>
                  <div class="text-sm text-muted-foreground">
                    <p>Fecha: {{ formatDate(viewingDocument()!.upload_date) }}</p>
                  </div>
                </div>
                <p class="text-sm text-muted-foreground">
                  Vista previa del documento PDF. En una aplicación real, aquí se mostraría el contenido del PDF.
                </p>
              </div>
            } @else {
              <div class="space-y-4">
                <div class="bg-white p-8 rounded-lg shadow-sm">
                  <svg class="h-16 w-16 mx-auto mb-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="9" cy="9" r="2"/>
                    <path d="m21 15-3.086-3.086a2 2 0 00-2.828 0L6 21"/>
                  </svg>
                  <h3 class="text-lg font-semibold mb-2">{{ viewingDocument()!.name }}</h3>
                  <p class="text-muted-foreground mb-4">{{ viewingDocument()!.description }}</p>
                  <div class="text-sm text-muted-foreground">
                    <p>Fecha: {{ formatDate(viewingDocument()!.upload_date) }}</p>
                  </div>
                </div>
                <p class="text-sm text-muted-foreground">
                  Vista previa de la imagen. En una aplicación real, aquí se mostraría la imagen completa.
                </p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>