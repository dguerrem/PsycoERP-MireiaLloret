<div class="flex flex-col">
  <!-- Header with Upload Button -->
  <div class="flex items-center justify-end gap-4 mb-4 sm:mb-6">
    <button
      (click)="openUploadModal()"
      style="background-color: #0891b2"
      class="hover:opacity-90 w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 text-white rounded-md transition-opacity font-medium">
      <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
      </svg>
      Subir Documentos
    </button>
  </div>

  <!-- Documents Table -->
  <div class="bg-card text-card-foreground flex flex-col rounded-xl border shadow-sm flex-1 overflow-hidden">
    <div class="px-6 py-6 flex-1 overflow-y-auto min-h-0">
      @if (documents.length > 0) {
        <div class="overflow-x-auto">
          <table class="w-full table-fixed">
            <colgroup>
              <col class="w-[30%]">
              <col class="w-[10%]">
              <col class="w-[50%]">
              <col class="w-[10%]">
            </colgroup>
            <thead class="sticky top-0 bg-card z-10">
              <tr class="border-b">
                <th class="text-left p-2 text-sm font-medium">Documento</th>
                <th class="text-left p-2 text-sm font-medium">Fecha</th>
                <th class="text-left p-2 text-sm font-medium">Descripción</th>
                <th class="text-left p-2 text-sm font-medium">Acciones</th>
              </tr>
            </thead>
              <tbody>
                @for (document of documents; track document.id) {
                  <tr class="border-b hover:bg-muted/50">
                    <td class="p-2">
                      <div class="flex items-center gap-3 min-w-0">
                        <svg class="h-4 w-4 flex-shrink-0" [class]="getFileIcon(document.type)" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" [innerHTML]="getFileIconSvg(document.type)">
                        </svg>
                        <span class="font-medium text-sm truncate">{{ document.name }}</span>
                      </div>
                    </td>
                    <td class="p-2 text-sm text-muted-foreground whitespace-nowrap">{{ formatDate(document.upload_date) }}</td>
                    <td class="p-2">
                      <div class="text-sm text-muted-foreground overflow-x-auto whitespace-nowrap max-w-full scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
                        {{ document.description || 'Sin descripción' }}
                      </div>
                    </td>
                    <td class="p-2">
                      <div class="flex items-center gap-2 justify-end">
                      <button
                        (click)="handleViewDocument(document)"
                        class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                      </button>
                      <button
                        (click)="handleDownloadDocument(document)"
                        class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                      </button>
                      <button
                        (click)="openDeleteModal(document)"
                        class="inline-flex items-center justify-center rounded-md px-2 py-1 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground text-destructive">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H9a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <div class="text-center py-12">
          <svg class="h-12 w-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M14 2v6h6" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 13H8" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 17H8" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 9H8" />
          </svg>
          <p class="text-muted-foreground">No hay documentos disponibles.</p>
          <p class="text-sm text-muted-foreground mt-2">
            Sube documentos usando el botón "Subir Documentos".
          </p>
        </div>
      }
    </div>
  </div>

  <!-- Upload Document Modal -->
  <app-reusable-modal
    [isOpen]="isUploadModalOpen()"
    [title]="'Subir Documento'"
    [subtitle]="'Sube un documento para el paciente'"
    [submitText]="'Subir Documento'"
    [isFormValid]="isUploadFormValid"
    [actionType]="'create'"
    (onSubmit)="handleUploadSubmit()"
    (onCancel)="closeUploadModal()">

    <div class="p-4 sm:p-6 space-y-6">
      <!-- File Upload Area -->
      <div class="space-y-4">
        <div class="flex items-center gap-3 pb-3 border-b border-gray-100">
          <div class="p-1.5 bg-blue-100 rounded-md">
            <svg class="h-4 w-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900">Archivo</h3>
        </div>

        <!-- Drag and Drop Area -->
        @if (!selectedFile()) {
          <div
            (drop)="onFileDrop($event)"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            [class]="isDragging() ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-gray-50'"
            class="relative border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer hover:border-blue-400 hover:bg-blue-50/50">
            <input
              #fileInput
              type="file"
              accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
              (change)="onFileSelected($event)"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">

            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            <p class="mt-2 text-sm text-gray-600">
              <span class="font-semibold text-blue-600">Haz clic para seleccionar</span> o arrastra el archivo aquí
            </p>
            <p class="mt-1 text-xs text-gray-500">
              PDF, JPG, PNG, DOC o DOCX (máx. 10MB)
            </p>
          </div>
        } @else {
          <!-- Selected File Preview -->
          <div class="border border-gray-200 rounded-lg p-4 bg-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3 flex-1 min-w-0">
                <div class="flex-shrink-0">
                  <svg class="h-10 w-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                  </svg>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900 truncate">{{ selectedFile()!.name }}</p>
                  <p class="text-xs text-gray-500">{{ formatFileSize(selectedFile()!.size) }}</p>
                </div>
              </div>
              <button
                type="button"
                (click)="removeSelectedFile()"
                class="flex-shrink-0 p-1 rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
        }
      </div>

      <!-- Description Field -->
      <div class="space-y-4">
        <div class="flex items-center gap-3 pb-3 border-b border-gray-100">
          <div class="p-1.5 bg-blue-100 rounded-md">
            <svg class="h-4 w-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900">Descripción</h3>
        </div>

        <div>
          <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
            Descripción del documento <span class="text-red-500">*</span>
          </label>
          <textarea
            id="description"
            rows="3"
            [value]="description()"
            (input)="onDescriptionChange($event)"
            placeholder="Ej: Informe inicial de evaluación psicológica del paciente"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
          <p class="mt-1 text-xs text-gray-500">Proporciona una breve descripción del contenido del documento</p>
        </div>
      </div>
    </div>
  </app-reusable-modal>

  <!-- Delete Confirmation Modal -->
  <app-confirmation-modal
    [isOpen]="isDeleteModalOpen()"
    [title]="'Eliminar Documento'"
    [message]="'¿Estás seguro de que deseas eliminar este documento? Esta acción no se puede deshacer.'"
    [itemName]="documentToDelete()?.name"
    [confirmText]="'Eliminar'"
    [cancelText]="'Cancelar'"
    [confirmButtonType]="'destructive'"
    (onConfirm)="confirmDeleteDocument()"
    (onCancel)="closeDeleteModal()">
  </app-confirmation-modal>
</div>