<!-- Main container con layout sticky -->
<div class="h-full flex flex-col max-h-full overflow-hidden p-4 md:p-6">

  <!-- Header section (fijo) -->
  <app-section-header title="Gestión de Clínicas" subtitle="Administra las clínicas registradas en la plataforma"
    buttonText="Nueva Clínica" (onButtonClick)="openCreateForm()">
  </app-section-header>

  <!-- Sistema de pestañas -->
  <div class="flex-1 overflow-hidden">
    <div class="gap-2 h-full flex flex-col">
      <!-- Tabs header -->
      <div role="tablist"
        class="bg-muted text-muted-foreground items-center justify-center rounded-lg p-[3px] grid w-full grid-cols-2 h-12 mt-6">
        <button type="button" role="tab" [attr.aria-selected]="activeTab() === 'active'"
          [class]="getTabClasses('active')" (click)="setActiveTab('active')">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-building h-4 w-4">
            <rect width="16" height="20" x="4" y="2" rx="2" ry="2"></rect>
            <path d="M9 22v-4h6v4"></path>
            <path d="M8 6h.01"></path>
            <path d="M16 6h.01"></path>
            <path d="M12 6h.01"></path>
            <path d="M12 10h.01"></path>
            <path d="M12 14h.01"></path>
            <path d="M16 10h.01"></path>
            <path d="M16 14h.01"></path>
            <path d="M8 10h.01"></path>
            <path d="M8 14h.01"></path>
          </svg>
          Clínicas Activas
          <span
            class="inline-flex items-center justify-center rounded-md border font-medium w-fit whitespace-nowrap shrink-0 gap-1 ml-1 px-2 py-0.5 text-xs bg-green-50 text-green-700 border-green-200">
            {{ activeClinicsCount() }}
          </span>
        </button>
        <button type="button" role="tab" [attr.aria-selected]="activeTab() === 'inactive'"
          [class]="getTabClasses('inactive')" (click)="setActiveTab('inactive')">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-building-2 h-4 w-4">
            <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path>
            <path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path>
            <path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path>
            <path d="M10 6h4"></path>
            <path d="M10 10h4"></path>
            <path d="M10 14h4"></path>
            <path d="M10 18h4"></path>
          </svg>
          Clínicas Inactivas
          <span
            class="inline-flex items-center justify-center rounded-md border font-medium w-fit whitespace-nowrap shrink-0 gap-1 ml-1 px-2 py-0.5 text-xs bg-gray-50 text-gray-700 border-gray-200">
            {{ inactiveClinicsCount() }}
          </span>
        </button>
      </div>

      <!-- Tab content -->
      <div class="flex-1 overflow-hidden mt-6">
        @if (activeTab() === 'active') {
        <div role="tabpanel" class="flex-1 outline-none h-full flex flex-col relative">
          <div class="flex-1 overflow-y-auto pb-20">
            <app-clinics-list [clinics]="clinicsList()" [trackByFn]="trackByClinicId" [isDeletedView]="false"
              (onEdit)="openEditForm($event)" (onDelete)="openDeleteModal($event)"
              (onRestore)="openRestoreModal($event)">
            </app-clinics-list>
          </div>

          <!-- Pagination for active clinics -->
          @if (paginationData()) {
          <div class="absolute bottom-0 left-0 right-0">
            <app-pagination [currentPage]="paginationData()!.currentPage" [totalPages]="paginationData()!.totalPages"
              [totalRecords]="paginationData()!.totalRecords" [recordsPerPage]="paginationData()!.recordsPerPage"
              [hasNextPage]="paginationData()!.hasNextPage" [hasPrevPage]="paginationData()!.hasPrevPage"
              (onPageChange)="onPageChange($event)" (onPageSizeChange)="onPageSizeChange($event)">
            </app-pagination>
          </div>
          }
        </div>
        }

        @if (activeTab() === 'inactive') {
        <div role="tabpanel" class="flex-1 outline-none h-full flex flex-col relative">
          <div class="flex-1 overflow-y-auto pb-20">
            <app-clinics-list [clinics]="clinicsList()" [trackByFn]="trackByClinicId" [isDeletedView]="true"
              (onEdit)="openEditForm($event)" (onDelete)="openDeleteModal($event)"
              (onRestore)="openRestoreModal($event)">
            </app-clinics-list>
          </div>

          <!-- Pagination for inactive clinics -->
          @if (paginationData()) {
          <div class="absolute bottom-0 left-0 right-0">
            <app-pagination [currentPage]="paginationData()!.currentPage" [totalPages]="paginationData()!.totalPages"
              [totalRecords]="paginationData()!.totalRecords" [recordsPerPage]="paginationData()!.recordsPerPage"
              [hasNextPage]="paginationData()!.hasNextPage" [hasPrevPage]="paginationData()!.hasPrevPage"
              (onPageChange)="onPageChange($event)" (onPageSizeChange)="onPageSizeChange($event)">
            </app-pagination>
          </div>
          }
        </div>
        }
      </div>
    </div>
  </div>

</div>

<!-- Clinic Form Modal -->
<app-clinica-form [isOpen]="showForm()" [clinica]="editingClinica()" (onSave)="handleSave($event)"
  (onCancel)="closeForm()">
</app-clinica-form>

<!-- Delete Confirmation Modal -->
<app-confirmation-modal [isOpen]="deletingClinic() !== null" title="Confirmar Eliminación"
  message="¿Estás seguro de que deseas eliminar la clínica " [itemName]="deletingClinic()?.name" confirmText="Eliminar"
  cancelText="Cancelar" confirmButtonType="destructive" (onConfirm)="handleDeleteClinic()"
  (onCancel)="closeDeleteModal()">
</app-confirmation-modal>

<!-- Restore Confirmation Modal -->
<app-confirmation-modal [isOpen]="restoringClinic() !== null" title="Confirmar Restauración"
  message="¿Estás seguro de que deseas restaurar la clínica " [itemName]="restoringClinic()?.name"
  confirmText="Restaurar" cancelText="Cancelar" confirmButtonType="primary" (onConfirm)="handleRestoreClinic()"
  (onCancel)="closeRestoreModal()">
</app-confirmation-modal>
